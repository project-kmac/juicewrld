apiVersion: automation.cloudbees.io/v1alpha1
kind: workflow
name: Juice Shop Demo Workflow
on:
  push:
    branches:
      - "**"
  workflow_dispatch:
permissions:
  scm-token-own: read
  scm-token-org: read
  id-token: write
jobs:
  test:
    steps:
      - name: Get source code
        uses: cloudbees-io/checkout@v1
      - name: Simple test step
        uses: docker://alpine:latest
        run: |
          echo "ğŸ§ª Running basic tests..."
          echo "âœ… Test 1: Application structure check - PASSED"
          echo "âœ… Test 2: Configuration validation - PASSED"
          echo "âœ… Test 3: Security baseline - PASSED"
          echo "ğŸ“Š All tests completed successfully"
      - name: Publish evidence
        uses: cloudbees-io/publish-evidence-item@v1
        with:
          content: |-
            ## Test Results Summary
            
            âœ… **Application Structure Check**: PASSED  
            âœ… **Configuration Validation**: PASSED  
            âœ… **Security Baseline**: PASSED  
            
            **Total Tests**: 3  
            **Passed**: 3  
            **Failed**: 0  
            **Coverage**: 100%
          format: MARKDOWN

  build:
    needs: test
    steps:
      - name: Get source code
        uses: cloudbees-io/checkout@v1
      - name: Simulate build
        uses: docker://alpine:latest
        run: |
          echo "ğŸ”¨ Building Juice Shop Demo..."
          echo "ğŸ“¦ Creating application package..."
          echo "ğŸ—ï¸  Compiling assets..."
          echo "âœ… Build completed successfully"
          echo "ğŸ“‹ Build artifacts ready for deployment"
      - name: Publish evidence
        uses: cloudbees-io/publish-evidence-item@v1
        with:
          content: |-
            ## Build Results
            
            âœ… **Application Package**: Created successfully  
            âœ… **Asset Compilation**: Completed  
            âœ… **Build Artifacts**: Ready for deployment  
            
            **Build Status**: SUCCESS  
            **Build Time**: 2m 34s  
            **Artifact Size**: 45.2 MB
          format: MARKDOWN

  deploy:
    needs: build
    steps:
      - name: Simulate deployment
        uses: docker://alpine:latest
        run: |
          echo "ğŸš€ Deploying to Demo Environment..."
          echo "ğŸŒ Setting up virtual infrastructure..."
          echo "ğŸ“¡ Configuring load balancer..."
          echo "ğŸ”§ Applying configuration..."
          echo "âœ… Deployment completed successfully"
          echo "ğŸ”— Application available at: https://juice-shop-demo.example.com"
      - name: Publish evidence
        uses: cloudbees-io/publish-evidence-item@v1
        with:
          content: |-
            ## Deployment Completed Successfully
            
            **Environment**: Demo Environment  
            **Status**: âœ… Healthy  
            **URL**: https://juice-shop-demo.example.com  
            
            ### Deployment Details
            - âœ… Infrastructure: Provisioned
            - âœ… Load Balancer: Configured
            - âœ… Application: Running
            - âœ… Health Checks: Passing
            
            **Deployment Time**: 1m 45s  
            **Response Time**: 150ms
          format: MARKDOWN
